---
title: "STAT6014 Lecture 1"
author: "Jason Chan"
date: "2/2/2020"
output: 
  html_document:
    toc: true
---
# Libraries

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(glm2)
```

# Analyzing Challenger Data

## EDA

```{r}
ca <-data.frame("Temp"=c(53,56,57,63,66,67,67,67,68,69,70,70,
70,70,72,73,75,75,76,76,78,79,80,81),
"Failure"=c(rep(1,3),rep(0,8),rep(1,3),rep(0,3),
1,rep(0,6)))

summary(ca)
```


```{r}
ca
```

```{r}
table(ca$Failure)
```

A lot more 0's than 1's, imbalanced.

## Modelling using Logistric Regression
```{r}
# using glm2 function

fit <- glm2(formula = Failure~Temp, family = "binomial", data = ca)
summary(fit)
```

* This implies that $\beta_0 = 10.87535$ and $\beta_1 = -0.17132$

* This means that the fitted model is $logit(\pi) = 10.87535-0.17132x$

* And the estimated probability $\pi_i = e^{10.87535  -0.17132x} / (1+e^{10.87535  -0.17132x})$

## Prediction

```{r}
plotdata<-data.frame(Temp = seq(50,85,0.1))
predicted <-predict(fit, newdata= plotdata, type = "response")
```

## Probability Plot
```{r}
plot(ca$Temp, ca$Failure, pch= 16, xlim= c(50,85), xlab= "Temperature", ylab= "Probability")
lines(plotdata$Temp, predicted)
```

Probality of break at Temp=50 Farenheit

```{r}
predict(fit, newdata= data.frame(Temp = c(50)), type = "response")
```

## Interpreting the Parameters (Beta)

```{r}
cbind(OR=coef(fit), confint(fit))
```

Need to exponential it to get the odds ratio

```{r}
exp(cbind(OR=coef(fit), confint(fit)))
```

Since the **odds ratio (OR)** of Temp is 0.843 < 1, Temp is associated with a decrease in odds of 16% for an increase of 1 unit in Temp.

```{r}
1 - 8.425515e-01
```


For an increase in 5F in Temp, would result in odd reduction of

```{r}
1 - exp(5*-0.1713205)
```

# Analyzing Neuralgia Patients Data

## EDA
```{r, echo=FALSE}
library(lmtest)
```

```{r}
# Create dataframe for Neuralgia Patients data
npd <- data.frame("Trt"=c('A','B','P'),
                  "Pain"=c(4,5,15),
                  "NoPain"=c(16,15,5))

# set reference class of Trt to 'P' for reference coding
npd$Trt <- relevel(npd$Trt, ref='P')

npd
```

## Modelling

Note that data above is aggregated and will use a different syntax for model fitting as below:

```{r}
fit <- glm2(cbind(Pain, NoPain) ~ Trt, family = 'binomial', data=npd)
summary(fit)
```

* Hence, the fitted model is $logit(\pi_x)=1.0986 - 2.4849I_A - 2.1972I_B$

* The logits for each treatment are:
  * Treatment A: $logit(\pi_A)=1.0986 - 2.4849I_A=-1.3863$
  * Treatment B: $logit(\pi_B)=1.0986 - 2.1972I_B=-1.0986$
  * Placebo: $logit(\pi_P)=1.0986$

Their probabilities of Pain are:

```{r}
prob_func <- function(x){
  return(exp(x)/(1+exp(x)))
}

prob_func(c(-1.3863, -1.0986, 1.0986))
```

Placebo still gives high prob of pain compared to treatment A and B

Odds ratio of A to B:

```{r}
exp(-2.4849 - (-2.1972))
```
Hence, a 25% reduction in odds of pain by treatment A compared to B.


Odds Reduction:

```{r}
exp(cbind(OR=coef(fit), confint(fit)))
```

Obviously Treatment A has the highest reduction in odds.